<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Viento Car</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }

        :root {
            --dark: #041027;
            --gold: #D4AF37;
            --gold-2: #F0C65A;
            --sidebar: #0a1e4a;
            --primary: #0c4488;
            --bg: #050d1f;
            --card-bg: #1a2d52;
            --text-light: #b0b8c9;
            --success-bg: rgba(16, 185, 129, 0.2);
            --success-text: #10B981;
            --danger-bg: rgba(239, 68, 68, 0.2);
            --danger-text: #EF4444;
        }

        body {
            background: linear-gradient(135deg, var(--bg) 0%, var(--dark) 100%);
            color: white;
            overflow-x: hidden;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            position: fixed; left: 0; top: 0; height: 100vh; width: 280px;
            background: var(--sidebar);
            border-right: 1px solid rgba(212, 175, 55, 0.2);
            z-index: 1000; transition: all 0.3s ease;
            display: flex; flex-direction: column;
            box-shadow: 4px 0 20px rgba(0,0,0,0.3);
        }

        .sidebar-logo { padding: 2rem 1.5rem; border-bottom: 1px solid rgba(212, 175, 55, 0.2); }
        .sidebar-logo h3 { font-size: 1.5rem; font-weight: 700; color: var(--gold); margin: 0; display: flex; align-items: center; gap: 0.5rem; }
        
        .nav-menu { flex: 1; padding: 1.5rem 1rem; overflow-y: auto; }
        .nav-item { margin-bottom: 0.5rem; }
        .nav-link { display: flex; align-items: center; padding: 0.875rem 1rem; color: var(--text-light); text-decoration: none; border-radius: 12px; transition: all 0.3s ease; font-weight: 500; font-size: 0.95rem; }
        .nav-link:hover { background: rgba(212, 175, 55, 0.1); color: var(--gold); transform: translateX(4px); }
        .nav-link.active { background: rgba(212, 175, 55, 0.15); color: var(--gold); border-left: 4px solid var(--gold); }
        .nav-icon { width: 24px; height: 24px; margin-right: 0.875rem; font-size: 1.25rem; display: flex; align-items: center; justify-content: center; }

        /* ===== MAIN CONTENT ===== */
        .main-content { margin-left: 280px; min-height: 100vh; padding: 2rem; transition: all 0.3s ease; }

        /* ===== HEADER ===== */
        .admin-header {
            background: var(--card-bg); border-radius: 20px; padding: 2rem; margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3); border: 1px solid rgba(212, 175, 55, 0.2);
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;
        }
        .admin-header h2 { font-size: 1.75rem; font-weight: 700; margin: 0; color: white; }
        .admin-header p { margin: 0.25rem 0 0 0; color: var(--text-light); font-size: 0.95rem; }

        .status-badge {
            display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.625rem 1.25rem;
            border-radius: 50px; font-weight: 600; font-size: 0.875rem;
            background: var(--success-bg); color: var(--success-text); border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .pulse-dot { width: 8px; height: 8px; background: var(--success-text); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* ===== STATS CARDS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            border: 1px solid rgba(212, 175, 55, 0.2);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, var(--gold) 0%, var(--gold-2) 100%);
            opacity: 0; transition: opacity 0.3s ease;
        }

        .stat-card:hover { transform: translateY(-5px); border-color: var(--gold); }
        .stat-card:hover::before { opacity: 1; }

        .stat-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .stat-icon {
            width: 42px; height: 42px;
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem;
            background: rgba(212, 175, 55, 0.15);
            color: var(--gold);
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 0.1rem;
            line-height: 1.2;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .stat-trend {
            display: inline-flex; align-items: center; gap: 0.2rem;
            font-size: 0.75rem;
            font-weight: 600; margin-top: 0.5rem;
            padding: 0.25rem 0.5rem; border-radius: 6px;
            background: var(--success-bg); color: var(--success-text);
        }

        /* ===== DATA TABLES ===== */
        .data-section {
            background-color: var(--card-bg) !important; 
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .section-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 1.5rem; padding-bottom: 1rem;
            border-bottom: 2px solid rgba(212, 175, 55, 0.2);
        }

        .section-header h4 {
            font-size: 1.35rem; font-weight: 700; margin: 0; color: white;
        }

        /* Table Styling Overrides */
        .table {
            --bs-table-bg: transparent !important;
            --bs-table-accent-bg: transparent !important;
            margin: 0; font-size: 0.925rem; width: 100%;
        }

        .table > :not(caption) > * > * {
            background-color: transparent !important; 
            color: var(--text-light) !important;
            border-bottom-color: rgba(212, 175, 55, 0.1) !important;
            box-shadow: none !important;
        }

        .table thead th {
            color: var(--gold) !important;
            font-weight: 700; font-size: 0.825rem;
            text-transform: uppercase; letter-spacing: 0.5px;
            border-bottom: 2px solid rgba(212, 175, 55, 0.2) !important;
            padding: 1rem;
        }

        .table tbody td { padding: 1.125rem 1rem; vertical-align: middle; }

        .table tbody tr:hover > * {
            background-color: rgba(212, 175, 55, 0.05) !important;
            color: white !important;
            box-shadow: inset 0 0 0 9999px rgba(212, 175, 55, 0.05) !important;
        }
        
        .table strong { color: var(--gold) !important; }

        /* Badges */
        .verified-badge {
            display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px;
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            border-radius: 50%; color: white; font-size: 0.65rem;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .warning-badge {
            display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.25rem 0.625rem;
            background: var(--danger-bg); color: var(--danger-text); border-radius: 6px;
            font-size: 0.75rem; font-weight: 600; border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .rating-stars { color: var(--gold); font-size: 0.875rem; display: block; margin-top: 2px;}
        .user-email { font-size: 0.825rem; color: var(--text-light); }

        /* Buttons & Badges */
        .btn-modern {
            padding: 0.625rem 1.25rem; border-radius: 12px; font-weight: 600; font-size: 0.875rem;
            border: none; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 0.5rem;
        }
        .btn-modern.primary { background: var(--gold); color: var(--dark); }
        .btn-modern.outline { background: transparent; border: 2px solid rgba(212, 175, 55, 0.5); color: var(--gold); }
        .btn-modern:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3); }

        .btn-action { padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.8rem; font-weight: 600; border: none; transition: all 0.2s ease; margin: 0 0.25rem; }
        .btn-action:hover { transform: scale(1.05); }

        .badge-modern { padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.8rem; display: inline-flex; align-items: center; gap: 0.375rem; }
        .badge-modern.success { background: var(--success-bg); color: var(--success-text); border: 1px solid rgba(16, 185, 129, 0.3); }
        .badge-modern.danger { background: var(--danger-bg); color: var(--danger-text); border: 1px solid rgba(239, 68, 68, 0.3); }
        .badge-modern.info { background: rgba(59, 130, 246, 0.2); color: #3B82F6; border: 1px solid rgba(59, 130, 246, 0.3); }
        .badge-modern.warning { background: rgba(245, 158, 11, 0.2); color: #F59E0B; border: 1px solid rgba(245, 158, 11, 0.3); }
        .badge-modern.secondary { background: rgba(176, 184, 201, 0.2); color: var(--text-light); border: 1px solid rgba(176, 184, 201, 0.3); }

        .content-section { display: none; animation: fadeIn 0.3s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 992px) {
            .sidebar { transform: translateX(-280px); }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-left: 0; }
        }

        /* ===== ACİL GÖRÜNÜRLÜK DÜZELTMESİ ===== */
        .table, .table tbody, .table td, .table tfoot, .table th, .table thead, .table tr {
            color: #e2e8f0 !important;
            background-color: transparent !important;
            border-color: rgba(212, 175, 55, 0.1) !important;
        }

        .data-section, .stat-card, .admin-header {
            background-color: #1a2d52 !important;
            color: white !important;
        }
        
        .table thead th {
            color: #D4AF37 !important;
            font-weight: bold !important;
        }

        .table tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.05) !important;
        }

        /* ===== MODERN MODAL TASARIMI ===== */
        .custom-modal-content {
            background: linear-gradient(145deg, #1a2d52 0%, #041027 100%);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            color: white;
            overflow: hidden;
        }

        .modal-header-profile {
            background: linear-gradient(90deg, rgba(212, 175, 55, 0.1) 0%, rgba(26, 45, 82, 0) 100%);
            padding: 2rem;
            text-align: center;
            border-bottom: 1px solid rgba(212, 175, 55, 0.1);
        }

        .profile-avatar-large {
            width: 100px; height: 100px; border-radius: 50%;
            background: none;
            color: var(--dark);
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 1rem auto;
            border: 4px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            overflow: hidden; /* Resmin taşmaması için */
        }
        .profile-avatar-large img {
            width: 100%; height: 100%; object-fit: cover;
        }

        .profile-name { font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 0.25rem; }

        .profile-role-badge {
            background: rgba(212, 175, 55, 0.2); color: var(--gold); padding: 0.25rem 0.75rem;
            border-radius: 50px; font-size: 0.8rem; font-weight: 600;
            border: 1px solid rgba(212, 175, 55, 0.3);
            text-transform: uppercase; letter-spacing: 1px;
        }

        .info-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; padding: 2rem;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.03); padding: 1rem; border-radius: 16px;
            transition: all 0.3s ease; border: 1px solid transparent;
        }

        .info-item:hover {
            background: rgba(255, 255, 255, 0.06); border-color: rgba(212, 175, 55, 0.2); transform: translateY(-2px);
        }

        .info-label {
            font-size: 0.75rem; color: var(--text-light); text-transform: uppercase;
            letter-spacing: 0.5px; margin-bottom: 0.5rem;
            display: flex; align-items: center; gap: 0.5rem;
        }

        .info-value {
            font-size: 1rem; font-weight: 600; color: white; word-break: break-word;
        }

        /* ===== [DÜZELTME] MODAL ZORLA AÇMA (MANUEL CSS) ===== */
        .modal.custom-show {
            display: block !important;
            opacity: 1 !important;
            background-color: rgba(0, 0, 0, 0.8) !important;
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-logo">
            <h3><span></span> Viento Admin</h3>
        </div>
        <ul class="nav-menu">
            <li class="nav-item"><a href="#" class="nav-link active" onclick="gosterBolum('dashboard')"><span class="nav-icon"><i class="bi bi-grid-1x2-fill"></i></span> Genel Bakış</a></li>
            <li class="nav-item"><a href="#" class="nav-link" onclick="gosterBolum('kullanicilar')"><span class="nav-icon"><i class="bi bi-people"></i></span> Kullanıcılar</a></li>
            <li class="nav-item"><a href="#" class="nav-link" onclick="gosterBolum('yolculuklar')"><span class="nav-icon"><i class="bi bi-car-front"></i></span> Yolculuklar</a></li>
            <li class="nav-item"><a href="#" class="nav-link" onclick="gosterBolum('rezervasyonlar')"><span class="nav-icon"><i class="bi bi-calendar-check"></i></span> Rezervasyonlar</a></li>
            <li class="nav-item"><a href="#" class="nav-link" onclick="gosterBolum('odemeler')"><span class="nav-icon"><i class="bi bi-credit-card"></i></span> Ödemeler</a></li>
            <li class="nav-item"><a href="/admin-cikis" class="nav-link"><span class="nav-icon"><i class="bi bi-box-arrow-right"></i></span> Çıkış Yap</a></li>
        </ul>
    </aside>

    <main class="main-content">
        <div class="admin-header">
            <div>
                <h2>Hoş Geldin, <%= admin.ad_soyad %></h2>
                <p>Sistem yönetim paneline hoş geldiniz</p>
            </div>
            <div>
                <span class="status-badge"><span class="pulse-dot"></span> Sistem Aktif</span>
            </div>
        </div>

        <div id="dashboard" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header"><div class="stat-icon"><i class="bi bi-people-fill"></i></div></div>
                    <div class="stat-value"><%= istatistikler.toplamKullanici %></div>
                    <div class="stat-label">Toplam Kullanıcı</div>
                    <% if(trendler.userNew > 0) { %>
                        <div class="stat-trend" style="background:var(--success-bg); color:var(--success-text)"><i class="bi bi-arrow-up-short"></i> <strong>+<%= trendler.userNew %></strong> Yeni (Son 30 Gün)</div>
                    <% } else { %>
                        <div class="stat-trend" style="background:rgba(255,255,255,0.05); color:var(--text-light)"><i class="bi bi-dash"></i> Değişim Yok</div>
                    <% } %>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><div class="stat-icon"><i class="bi bi-car-front-fill"></i></div></div>
                    <div class="stat-value"><%= istatistikler.toplamYolculuk %></div>
                    <div class="stat-label">Toplam Yolculuk</div>
                    <% if(trendler.tripNew > 0) { %>
                        <div class="stat-trend" style="background:var(--success-bg); color:var(--success-text)"><i class="bi bi-arrow-up-short"></i> <strong>+<%= trendler.tripNew %></strong> Yeni (Son 30 Gün)</div>
                    <% } else { %>
                        <div class="stat-trend" style="background:rgba(255,255,255,0.05); color:var(--text-light)"><i class="bi bi-dash"></i> Değişim Yok</div>
                    <% } %>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><div class="stat-icon"><i class="bi bi-calendar-check-fill"></i></div></div>
                    <div class="stat-value"><%= istatistikler.toplamRezervasyon %></div>
                    <div class="stat-label">Rezervasyon</div>
                    <% if(trendler.rezNew > 0) { %>
                        <div class="stat-trend" style="background:var(--success-bg); color:var(--success-text)"><i class="bi bi-arrow-up-short"></i> <strong>+<%= trendler.rezNew %></strong> Yeni (Son 30 Gün)</div>
                    <% } else { %>
                        <div class="stat-trend" style="background:rgba(255,255,255,0.05); color:var(--text-light)"><i class="bi bi-dash"></i> Değişim Yok</div>
                    <% } %>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><div class="stat-icon"><i class="bi bi-currency-exchange"></i></div></div>
                    <div class="stat-value"><%= istatistikler.toplamGelir %> ₺</div>
                    <div class="stat-label">Toplam Gelir</div>
                    <% if(trendler.incomeNew > 0) { %>
                        <div class="stat-trend" style="background:var(--success-bg); color:var(--success-text)"><i class="bi bi-arrow-up-short"></i> <strong>+<%= trendler.incomeNew %> ₺</strong> (Son 30 Gün)</div>
                    <% } else { %>
                        <div class="stat-trend" style="background:rgba(255,255,255,0.05); color:var(--text-light)"><i class="bi bi-dash"></i> Değişim Yok</div>
                    <% } %>
                </div>
            </div>

            <div class="data-section">
                <div class="section-header"><h4>Son Aktiviteler</h4></div>
                <div class="table-responsive">
                    <table class="table">
                        <thead><tr><th>Tarih</th><th>İşlem</th><th>Kullanıcı</th><th>Durum</th></tr></thead>
                        <tbody>
                            <% if (kullanicilar.length > 0) { %>
                                <% kullanicilar.slice(0, 5).forEach(k => { %>
                                <tr>
                                    <td><%= new Date(k.kayit_tarihi).toLocaleDateString('tr-TR', { day: 'numeric', month: 'long' }) %></td>
                                    <td><span class="badge-modern info"><i class="bi bi-person-plus-fill"></i> Yeni Üye</span></td>
                                    <td>
                                        <div class="user-info">
                                            <div class="user-avatar"><%= k.ad_soyad.charAt(0).toUpperCase() %></div>
                                            <div class="user-details"><span class="user-name"><%= k.ad_soyad %></span><span class="user-email" style="font-size: 0.75rem; opacity: 0.7;"><%= k.email %></span></div>
                                        </div>
                                    </td>
                                    <td><span class="badge-modern success"><i class="bi bi-check-circle-fill"></i> Aktif</span></td>
                                </tr>
                                <% }); %>
                            <% } else { %>
                                <tr><td colspan="4" class="text-center" style="padding: 2rem;"><i class="bi bi-inbox" style="font-size: 2rem; opacity: 0.5;"></i><br>Henüz aktivite yok.</td></tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="kullanicilar" class="content-section">
            <div class="data-section">
                <div class="section-header"><h4>Kayıtlı Kullanıcılar</h4></div>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Foto</th> <th>ID</th>
                                <th>Kullanıcı & Güvenlik</th>
                                <th>E-posta</th>
                                <th>Telefon</th>
                                <th>Kayıt Tarihi</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% kullanicilar.forEach(k => { %>
                            <tr>
                                <td>
                                    <img src="<%= k.profil_foto && k.profil_foto !== 'default.png' ? '/uploads/' + k.profil_foto : '/images2/user (1).png' %>" 
                                         alt="Profil" 
                                         style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 1px solid #D4AF37;">
                                </td>

                                <td>#<%= k.id %></td>
                                <td>
                                    <div class="user-info">
                                        <div class="user-details">
                                            <span class="user-name" style="color: white; font-weight: 600;"><%= k.ad_soyad %></span>
                                            <span class="rating-stars"><i class="bi bi-star-fill" style="color:var(--gold)"></i> <%= k.puan || 5.0 %></span>
                                        </div>
                                    </div>
                                </td>
                                <td><%= k.email %></td>
                                <td><%= k.telefon %></td>
                                <td><%= new Date(k.kayit_tarihi).toLocaleDateString('tr-TR') %></td>
                                <td>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-sm btn-info btn-action" data-user='<%= JSON.stringify(k) %>' onclick="kullaniciDetayAc(this)"><i class="bi bi-eye"></i></button>
                                        <button class="btn btn-sm btn-danger btn-action" onclick="kullaniciSil('<%= k.id %>')"><i class="bi bi-trash"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="yolculuklar" class="content-section">
            <div class="data-section">
                <div class="section-header"><h4>Tüm Yolculuklar</h4></div>
                <div class="table-responsive">
                    <table class="table">
                        <thead><tr><th>ID</th><th>Güzergah</th><th>Tarih & Saat</th><th>Sürücü</th><th>Ücret</th><th>Durum</th><th>İşlemler</th></tr></thead>
                        <tbody>
                            <% yolculuklar.forEach(y => { %>
                            <tr>
                                <td>#<%= y.id %></td>
                                <td><strong><%= y.nereden %></strong><i class="bi bi-arrow-right mx-2" style="color:var(--gold)"></i><strong><%= y.nereye %></strong></td>
                                <td><i class="bi bi-calendar3" style="color:var(--gold)"></i> <%= y.tarih %><br><i class="bi bi-clock" style="color:var(--gold)"></i> <%= y.saat %></td>
                                <td><%= y.surucu_adi %></td>
                                <td><strong style="color:var(--gold)"><%= y.ucret %> ₺</strong></td>
                                <td>
                                    <% if(y.durum === 'aktif') { %> <span class="badge-modern success">Aktif</span>
                                    <% } else if(y.durum === 'tamamlandi') { %> <span class="badge-modern secondary">Tamamlandı</span>
                                    <% } else { %> <span class="badge-modern danger">İptal</span> <% } %>
                                </td>
                                <td>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-sm btn-info btn-action" onclick="yolculukDetayAc('<%= y.id %>')"><i class="bi bi-eye"></i></button>
                                        <button class="btn btn-sm btn-danger btn-action" onclick="yolculukSil('<%= y.id %>')"><i class="bi bi-trash"></i></button>
                                    </div>
                                </td>
                            </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="rezervasyonlar" class="content-section">
            <div class="data-section">
                <div class="section-header">
                    <h4>Rezervasyonlar</h4>
                </div>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Yolcu</th>
                                <th>Güzergah</th>
                                <th>Koltuk</th>
                                <th>Tutar</th>
                                <th>Durum</th>
                                <th>Tarih</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% rezervasyonlar.forEach(r => { %>
                            <tr>
                                <td>#<%= r.id %></td>
                                <td>
                                    <div class="user-info">
                                        <div class="user-avatar">
                                            <%= r.yolcu_adi ? r.yolcu_adi.charAt(0).toUpperCase() : '?' %>
                                        </div>
                                        <div class="user-details">
                                            <span class="user-name">
                                                <%= r.yolcu_adi || 'Silinmiş Kullanıcı' %>
                                            </span>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <strong><%= r.nereden %></strong> 
                                    <i class="bi bi-arrow-right mx-1 text-muted"></i> 
                                    <strong><%= r.nereye %></strong>
                                </td>
                                <td><i class="bi bi-person"></i> <%= r.koltuk_sayisi %></td>
                                <td><strong style="color:var(--gold)"><%= r.toplam_ucret %> ₺</strong></td>
                                <td>
                                    <% if(r.odeme_durumu === 'tamamlandi') { %>
                                        <span class="badge-modern success">
                                            <i class="bi bi-check-circle-fill"></i> Ödendi
                                        </span>
                                    <% } else if(r.odeme_durumu === 'beklemede') { %>
                                        <span class="badge-modern warning">
                                            <i class="bi bi-hourglass-split"></i> Bekliyor
                                        </span>
                                    <% } else { %>
                                        <span class="badge-modern danger">
                                            <i class="bi bi-x-circle"></i> İptal
                                        </span>
                                    <% } %>
                                </td>
                                <td><%= new Date(r.rezervasyon_tarihi).toLocaleDateString('tr-TR') %></td>
                            </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="odemeler" class="content-section">
            <div class="data-section">
                <div class="section-header"><h4>Ödeme İşlemleri</h4></div>
                <div class="table-responsive">
                    <table class="table">
                        <thead><tr><th>ID</th><th>Rezervasyon</th><th>Tutar</th><th>Yöntem</th><th>Durum</th><th>Tarih</th></tr></thead>
                        <tbody>
                            <% odemeler.forEach(o => { %>
                            <tr>
                                <td>#<%= o.id %></td>
                                <td><span class="badge-modern info"><i class="bi bi-link-45deg"></i> #<%= o.rezervasyon_id %></span></td>
                                <td><strong style="color:var(--gold)"><%= o.tutar %> ₺</strong></td>
                                <td><i class="bi bi-credit-card" style="color:var(--gold)"></i> <%= o.odeme_yontemi %></td>
                                <td>
                                    <% if(o.durum === 'basarili') { %> <span class="badge-modern success"><i class="bi bi-check-circle-fill"></i> Başarılı</span>
                                    <% } else { %> <span class="badge-modern danger"><i class="bi bi-x-circle-fill"></i> Başarısız</span> <% } %>
                                </td>
                                <td><%= new Date(o.islem_tarihi).toLocaleDateString('tr-TR') %></td>
                            </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <div class="modal fade" id="userModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content custom-modal-content">
                <div class="modal-header-profile">
                    <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" data-bs-dismiss="modal"></button>
                    <div class="profile-avatar-large" id="modalAvatar">
                        <img id="modalProfilImg" src="/images2/user (1).png" alt="Profil">
                    </div>
                    <h3 class="profile-name" id="modalAd">Yükleniyor...</h3>
                    <span class="profile-role-badge" id="modalRol">USER</span>
                    <div class="mt-3"><span id="modalPuanRozet" class="badge-modern info" style="font-size: 1rem; padding: 0.5rem 1rem;">⭐ 5.0</span></div>
                </div>
                <div class="modal-body p-0">
                    <div class="info-grid">
                        <div class="info-item" style="grid-column: span 2;"><div class="info-label"><i class="bi bi-envelope text-warning"></i> E-Posta Adresi</div><div class="info-value" id="modalEmail">-</div></div>
                        <div class="info-item"><div class="info-label"><i class="bi bi-telephone text-success"></i> Telefon</div><div class="info-value" id="modalTel">-</div></div>
                        <div class="info-item"><div class="info-label"><i class="bi bi-calendar-check text-info"></i> Katılma Tarihi</div><div class="info-value" id="modalTarih">-</div></div>
                        <div class="info-item"><div class="info-label"><i class="bi bi-hash text-secondary"></i> Müşteri ID</div><div class="info-value" id="modalID">-</div></div>
                        <div class="info-item"><div class="info-label"><i class="bi bi-shield-check text-primary"></i> Hesap Durumu</div><div class="info-value text-success" id="modalDurum"><i class="bi bi-check-circle-fill"></i> Aktif Hesap</div></div>
                    </div>
                </div>
                <div class="modal-footer border-0 justify-content-center pb-4"><button type="button" class="btn btn-modern outline w-50" data-bs-dismiss="modal">Kapat</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="tripModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content custom-modal-content">
                <div class="modal-header-profile" style="padding-bottom: 1rem;">
                    <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" data-bs-dismiss="modal"></button>
                    <div class="text-center mb-3"><div class="badge-modern warning" style="font-size: 0.9rem;">YOLCULUK KARTI</div></div>
                    <div class="d-flex justify-content-center align-items-center gap-3">
                        <h3 id="tripNereden" class="m-0 fw-bold text-white">-</h3><i class="bi bi-arrow-right text-warning fs-3"></i><h3 id="tripNereye" class="m-0 fw-bold text-white">-</h3>
                    </div>
                </div>
                <div class="modal-body p-0">
                    <div class="info-grid">
                        <div class="info-item" style="grid-column: span 2;"><div class="info-label"><i class="bi bi-person-badge text-info"></i> Sürücü</div><div class="info-value" id="tripSurucu">-</div></div>
                        <div class="info-item"><div class="info-label"><i class="bi bi-calendar-event text-warning"></i> Tarih</div><div class="info-value" id="tripTarih">-</div></div>
                        <div class="info-item"><div class="info-label"><i class="bi bi-clock text-warning"></i> Kalkış Saati</div><div class="info-value" id="tripSaat">-</div></div>
                        <div class="info-item"><div class="info-label"><i class="bi bi-cash-stack text-success"></i> Kişi Başı Ücret</div><div class="info-value text-success" style="font-size: 1.2rem;" id="tripUcret">- ₺</div></div>
                        <div class="info-item"><div class="info-label"><i class="bi bi-activity text-primary"></i> Durum</div><div class="info-value" id="tripDurum">-</div></div>
                        <div class="info-item" style="grid-column: span 2; border-top: 1px solid rgb(255, 255, 255); margin-top: 0.5rem; padding-top: 1rem;"><div class="info-label" style="color: #ffffff;"><i class="bi bi-hash"></i> Yolculuk Referans ID</div><div class="info-value text-muted" id="tripID">#000</div></div>
                    </div>
                </div>
                <div class="modal-footer border-0 justify-content-center pb-4"><button type="button" class="btn btn-modern outline w-50" data-bs-dismiss="modal">Kapat</button></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    <script>
        const TUM_YOLCULUKLAR = <%- yolculuklar && yolculuklar.length ? JSON.stringify(yolculuklar) : '[]' %>;
        
        function modalAcManuel(modalId) {
            const modal = document.getElementById(modalId);
            if(modal) {
                modal.classList.add('custom-show');
                modal.classList.add('show');
            }
        }

        function modalKapatManuel() {
            document.querySelectorAll('.modal').forEach(m => {
                m.classList.remove('custom-show');
                m.classList.remove('show');
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('[data-bs-dismiss="modal"]').forEach(btn => btn.onclick = modalKapatManuel);
        });

        function yolculukDetayAc(id) {
            const trip = TUM_YOLCULUKLAR.find(y => y.id == id);
            if (!trip) return;
            document.getElementById('tripNereden').innerText = trip.nereden;
            document.getElementById('tripNereye').innerText = trip.nereye;
            document.getElementById('tripSurucu').innerText = trip.surucu_adi;
            document.getElementById('tripUcret').innerText = trip.ucret + ' ₺';
            document.getElementById('tripID').innerText = '#' + trip.id;
            document.getElementById('tripSaat').innerText = trip.saat;
            document.getElementById('tripTarih').innerText = trip.tarih;
            
            const durumDiv = document.getElementById('tripDurum');
            if(trip.durum === 'aktif') durumDiv.innerHTML = '<span class="badge-modern success">Aktif</span>';
            else if(trip.durum === 'tamamlandi') durumDiv.innerHTML = '<span class="badge-modern secondary">Tamamlandı</span>';
            else durumDiv.innerHTML = '<span class="badge-modern danger">İptal</span>';
            
            modalAcManuel('tripModal');
        }

        function gosterBolum(bolumId) {
            document.querySelectorAll('.content-section').forEach(s => s.style.display = 'none');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const secilen = document.getElementById(bolumId);
            if(secilen) { secilen.style.display = 'block'; secilen.classList.add('active'); }
            if(event && event.currentTarget) event.currentTarget.classList.add('active');
        }

        // KULLANICI DETAY MODALI - FOTOĞRAF MANTIĞI EKLENDİ
        function kullaniciDetayAc(buton) {
            try {
                const user = JSON.parse(buton.getAttribute('data-user'));
                document.getElementById('modalAd').innerText = user.ad_soyad;
                document.getElementById('modalEmail').innerText = user.email;
                document.getElementById('modalTel').innerText = user.telefon;
                document.getElementById('modalRol').innerText = (user.role || 'user').toUpperCase();
                document.getElementById('modalPuanRozet').innerText = '⭐ ' + (user.puan || 5.0);
                document.getElementById('modalID').innerText = '#' + user.id;

                // Dinamik fotoğraf kontrolü
                const modalImg = document.getElementById('modalProfilImg');
                if(user.profil_foto && user.profil_foto !== 'default.png') {
                    modalImg.src = '/uploads/' + user.profil_foto;
                } else {
                    modalImg.src = '/images2/user (1).png';
                }

                modalAcManuel('userModal');
            } catch(e) { console.error(e); }
        }

        function kullaniciSil(id) {
            if(confirm('Silinsin mi?')) {
                fetch('/admin/kullanici-sil/' + id, { method: 'DELETE' })
                .then(res => res.json())
                .then(data => { alert(data.mesaj); location.reload(); });
            }
        }
    </script>
</body>
</html>